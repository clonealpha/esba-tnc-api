syntax = "proto3";

package tnc;

option go_package = "github.com/clonealpha/esba-tnc-api/proto/tnc";

// âœ… UTNCê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ ì •ì˜
service TNCService {
  // ğŸ”¹ TNCê°€ UTNCì—ê²Œ ìµœì´ˆ SR í† í´ë¡œì§€ ì •ë³´ë¥¼ ì „ë‹¬ (UTNCê°€ tnc_idë¥¼ ìƒì„±í•˜ì—¬ ì‘ë‹µ)
  rpc InitialSRTopology(InitialSRTopologyRequest) returns (TopologyAck);

  // ğŸ”¹ SR í† í´ë¡œì§€ ì •ë³´ ì—…ë°ì´íŠ¸
  rpc UpdateSRTopology(UpdateSRTopologyRequest) returns (TopologyAck);

  // ğŸ”¹ íŠ¹ì • SR í† í´ë¡œì§€ ì •ë³´ ì‚­ì œ
  rpc DeleteSRTopology(DeleteSRTopologyRequest) returns (TopologyAck);

  // ğŸ”¹ UTNCê°€ ì €ì¥í•œ ìµœì‹  SR í† í´ë¡œì§€ ìƒíƒœ ì¡°íšŒ
  rpc GetSRTopologyStatus(GetSRTopologyStatusRequest) returns (SRTopologyStatusResponse);

  // ğŸ”¹ SR ë…¸ë“œ ë˜ëŠ” ë§í¬ ì¥ì•  ë°œìƒ ë³´ê³ 
  rpc ReportSRFailure(SRFailureReport) returns (TopologyAck);
}

// âœ… ìµœì´ˆ SR í† í´ë¡œì§€ ìš”ì²­ (TNC â†’ UTNC)
message InitialSRTopologyRequest {
  string tnc_name = 1;  // ğŸ”¹ TNC ì‹ë³„ì (ì˜ˆ: MAC ì£¼ì†Œ "00:1A:2B:3C:4D:5E")
  repeated SRNode nodes = 2;
  repeated SRLink links = 3;
}

// âœ… SR í† í´ë¡œì§€ ì—…ë°ì´íŠ¸ ìš”ì²­
message UpdateSRTopologyRequest {
  string tnc_id = 1; // ğŸ”¹ UTNCê°€ ë°œê¸‰í•œ ID (ìµœì´ˆ InitialSRTopology ì‘ë‹µì—ì„œ ë°›ì€ ê°’)
  repeated SRNode nodes = 2;
  repeated SRLink links = 3;
}

// âœ… SR í† í´ë¡œì§€ ì‚­ì œ ìš”ì²­
message DeleteSRTopologyRequest {
  string tnc_id = 1; // ğŸ”¹ UTNCê°€ ë°œê¸‰í•œ ID
  repeated string node_ids = 2; // ì‚­ì œí•  ë…¸ë“œ ID ë¦¬ìŠ¤íŠ¸
  repeated string link_ids = 3; // ì‚­ì œí•  ë§í¬ ID ë¦¬ìŠ¤íŠ¸
}

// âœ… SR í† í´ë¡œì§€ ìƒíƒœ ì¡°íšŒ ìš”ì²­
message GetSRTopologyStatusRequest {
  string tnc_id = 1; // ğŸ”¹ UTNCê°€ ë¶€ì—¬í•œ ID (ìµœì´ˆ InitialSRTopology ì‘ë‹µì—ì„œ ë°›ì€ ê°’)
}

// âœ… SR í† í´ë¡œì§€ ìƒíƒœ ì‘ë‹µ
message SRTopologyStatusResponse {
  bool success = 1;
  repeated SRNode nodes = 2;
  repeated SRLink links = 3;
  int64 timestamp = 4; // ìµœê·¼ ì—…ë°ì´íŠ¸ ì‹œê°„
}

// âœ… ì¥ì•  ë°œìƒ ë³´ê³  ìš”ì²­ (TNC â†’ UTNC)
message SRFailureReport {
  string tnc_id = 1; // ğŸ”¹ UTNCê°€ ë°œê¸‰í•œ ID
  string failure_type = 2; // ì¥ì•  ìœ í˜• (ì˜ˆ: "NODE_DOWN", "LINK_DOWN")
  repeated string affected_nodes = 3; // ì¥ì• ê°€ ë°œìƒí•œ ë…¸ë“œ ID ë¦¬ìŠ¤íŠ¸
  repeated string affected_links = 4; // ì¥ì• ê°€ ë°œìƒí•œ ë§í¬ ID ë¦¬ìŠ¤íŠ¸
  int64 timestamp = 5; // ì¥ì•  ë°œìƒ ì‹œê°„
}

// âœ… UTNCì˜ ì‘ë‹µ ë©”ì‹œì§€ (ëª¨ë“  ìš”ì²­ ê³µí†µ)
message TopologyAck {
  bool success = 1; // ì •ìƒ ì²˜ë¦¬ ì—¬ë¶€ (true: ì„±ê³µ, false: ì‹¤íŒ¨)
  int32 error_code = 2; // ì˜¤ë¥˜ ì½”ë“œ (0: ì •ìƒ, 1: ë°ì´í„° ì˜¤ë¥˜, 2: gNB/UPF ëˆ„ë½ ë“±)
  string message = 3; // ì˜¤ë¥˜ ë©”ì‹œì§€ ë˜ëŠ” ìƒíƒœ ì„¤ëª…
  string tnc_id = 4; // UTNCê°€ ë°œê¸‰í•œ ID (ìµœì´ˆ InitialSRTopology ìš”ì²­ ì‹œ ë°˜í™˜)
  int64 timestamp = 5; // ì‘ë‹µ ì‹œê°„ (Unix timestamp)
}

// âœ… SR ë…¸ë“œ ì •ì˜
message SRNode {
  string node_id = 1;
  string name = 2;
  string sid = 3;
  string ip_address = 4;
  repeated string connected_nodes = 5;
  bool end_node = 6; // âœ… ì—”ë“œ ë…¸ë“œ ì—¬ë¶€ ì¶”ê°€
}

// âœ… SR ë§í¬ ì •ì˜
message SRLink {
  string link_id = 1;        // ğŸ”¹ ìë™ ìƒì„±ëœ ë§í¬ ID (ì˜ˆ: "sr3-sr4")
  string source = 2;
  string destination = 3;
  repeated Metric metrics = 4; // ğŸ”¹ ë„¤íŠ¸ì›Œí¬ ë§¤íŠ¸ë¦­ ë¦¬ìŠ¤íŠ¸
  int64 timestamp = 5;        // ğŸ”¹ ë§í¬ ì •ë³´ì˜ ìµœì‹  ì—…ë°ì´íŠ¸ ì‹œê°„ (Unix timestamp)
}

// âœ… ë„¤íŠ¸ì›Œí¬ ë©”íŠ¸ë¦­ ì •ì˜
message Metric {
  MetricType type = 1;
  float value = 2;  // ğŸ”¹ ë§¤íŠ¸ë¦­ ê°’
  string unit = 3;  // ğŸ”¹ ë‹¨ìœ„ (ì˜ˆ: "ms", "%", "Mbps")
}

// âœ… Metric Type Enum
enum MetricType {
  METRIC_UNKNOWN = 0;      // ê¸°ë³¸ê°’: ì •ì˜ë˜ì§€ ì•ŠìŒ
  METRIC_DELAY = 1;        // íŒ¨í‚· ì§€ì—° ì‹œê°„ (ms)
  METRIC_BANDWIDTH = 2;    // ë§í¬ ëŒ€ì—­í­ (Mbps)
  METRIC_JITTER = 3;       // ì§€í„° (ms)
  METRIC_PACKET_LOSS = 4;  // íŒ¨í‚· ì†ì‹¤ë¥  (%)
  METRIC_COST = 5;         // ì •ì±… ê¸°ë°˜ ë¹„ìš©
}